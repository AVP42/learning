# 中断机制

![image-20220104224254547](images/image-20220104224254547.png)

中断是操作系统的脉搏，是并发处理的基础。

![image-20220104224354474](images/image-20220104224354474.png)

![image-20220104224424622](images/image-20220104224424622.png)

![image-20220104224429344](images/image-20220104224429344.png)

![image-20220104224450229](images/image-20220104224450229.png)

![image-20220104224537699](images/image-20220104224537699.png)

![image-20220104224602148](images/image-20220104224602148.png)

![image-20220104224630866](images/image-20220104224630866.png)

目前x86采用APIC 高级可编程控制器

![image-20220104224710576](images/image-20220104224710576.png)

每一个x86的核都有本地的APIC

![image-20220104224741864](images/image-20220104224741864.png)

IO APIC 收集外设的中断，放一场总线上的信息，传递给某个cpu上的APIC





![image-20220104225018765](images/image-20220104225018765.png)

![image-20220104225127313](images/image-20220104225127313.png)

![image-20220104225145345](images/image-20220104225145345.png)

![image-20220104225155583](images/image-20220104225155583.png)

irq---中断请求号





![image-20220104225325944](images/image-20220104225325944.png)

![image-20220104225341180](images/image-20220104225341180.png)



![image-20220104225408061](images/image-20220104225408061.png)

![image-20220104225450500](images/image-20220104225450500.png)

![image-20220104225507601](images/image-20220104225507601.png)

![image-20220104225540945](images/image-20220104225540945.png)

所有的中断程序都有中断门来激活，并且全部限制在内核态

![image-20220104225609058](images/image-20220104225609058.png)

与中断门类似，其控制权通过陷阱门进入处理程序时，维持中断标识位不变，也就是不关中断，而中断门是关中断的。



![image-20220104225718270](images/image-20220104225718270.png)

系统们，用于让用户态的进程访问intel的陷阱门

系统调用就是通过系统门进入内核的。





## 中断描述表



![image-20220105203452102](images/image-20220105203452102.png)

中断描述符表，放在内核空间的数据段中，起始地址放在中断描述表寄存器



相关源代码

![image-20220105203620529](images/image-20220105203620529.png)



![image-20220105203631383](images/image-20220105203631383.png)

![image-20220105203637921](images/image-20220105203637921.png)

并且开始初始化各个表项



![image-20220105203903820](images/image-20220105203903820.png)

![image-20220105203911603](images/image-20220105203911603.png)

![image-20220105204005848](images/image-20220105204005848.png)

![image-20220105204022278](images/image-20220105204022278.png)

![image-20220105204032774](images/image-20220105204032774.png)

![image-20220105204127898](images/image-20220105204127898.png)



![image-20220105204229948](images/image-20220105204229948.png)

![image-20220105204246148](images/image-20220105204246148.png)

![image-20220105204250650](images/image-20220105204250650.png)

![image-20220105204255228](images/image-20220105204255228.png)

![image-20220105204312361](images/image-20220105204312361.png)

![image-20220105204318461](images/image-20220105204318461.png)

![image-20220105204325275](images/image-20220105204325275.png)

![image-20220105204334182](images/image-20220105204334182.png)

![image-20220105204340268](images/image-20220105204340268.png)





![image-20220105204437594](images/image-20220105204437594.png)

![image-20220105204442333](images/image-20220105204442333.png)

![image-20220105204448810](images/image-20220105204448810.png)

![image-20220105204454479](images/image-20220105204454479.png)

![image-20220105204518641](images/image-20220105204518641.png)

![image-20220105204523563](images/image-20220105204523563.png)

上图左边是特权级发生了变化，右边是特权级发生了变化





![image-20220105204941042](images/image-20220105204941042.png)

![image-20220105205046776](images/image-20220105205046776.png)

![image-20220105205100033](images/image-20220105205100033.png)

![image-20220105205151544](images/image-20220105205151544.png)







### 执行流程

![image-20220105205358336](images/image-20220105205358336.png)

![image-20220105205403302](images/image-20220105205403302.png)

![image-20220105205413273](images/image-20220105205413273.png)

![image-20220105205420861](images/image-20220105205420861.png)

![image-20220105205426314](images/image-20220105205426314.png)

![image-20220105205500201](images/image-20220105205500201.png)

![image-20220105205451888](images/image-20220105205451888.png)

![image-20220105205531200](images/image-20220105205531200.png)

![image-20220105205618920](images/image-20220105205618920.png)

![image-20220105205624490](images/image-20220105205624490.png)

![image-20220105205835360](images/image-20220105205835360.png)

![image-20220105205735027](images/image-20220105205735027.png)

![image-20220105205744538](images/image-20220105205744538.png)

![image-20220105205753448](images/image-20220105205753448.png)

![image-20220105205718007](images/image-20220105205718007.png)

![image-20220105205707471](images/image-20220105205707471.png)







### 中断，异常，系统调用

![image-20220105205926685](images/image-20220105205926685.png)



![image-20220105205951363](images/image-20220105205951363.png)



![image-20220105205958585](images/image-20220105205958585.png)

![image-20220105210004584](images/image-20220105210004584.png)

![image-20220105210009157](images/image-20220105210009157.png)

![image-20220105210015233](images/image-20220105210015233.png)





![image-20220105210044138](images/image-20220105210044138.png)

![image-20220105210047574](images/image-20220105210047574.png)

![image-20220105210053117](images/image-20220105210053117.png)

![image-20220105210058815](images/image-20220105210058815.png)

![image-20220105210104208](images/image-20220105210104208.png)

![image-20220105210111204](images/image-20220105210111204.png)

![image-20220105210118917](images/image-20220105210118917.png)

![image-20220105210129839](images/image-20220105210129839.png)





![image-20220105210138445](images/image-20220105210138445.png)

![image-20220105210144789](images/image-20220105210144789.png)

![image-20220105210149330](images/image-20220105210149330.png)

![image-20220105210155428](images/image-20220105210155428.png)

![image-20220105210200241](images/image-20220105210200241.png)

![image-20220105210204976](images/image-20220105210204976.png)









### 基本机制

![image-20220105210423679](images/image-20220105210423679.png)





### 中断下半部

中断分为两部分

![image-20220105210508784](images/image-20220105210508784.png)

![image-20220105210518594](images/image-20220105210518594.png)

![image-20220105210529663](images/image-20220105210529663.png)





![image-20220105210637983](images/image-20220105210637983.png)



![image-20220105210704889](images/image-20220105210704889.png)

![image-20220105210710608](images/image-20220105210710608.png)

![image-20220105210746497](images/image-20220105210746497.png)

![image-20220105210836675](images/image-20220105210836675.png)

![image-20220105210840179](images/image-20220105210840179.png)

![image-20220105210911603](images/image-20220105210911603.png)

![image-20220105211637461](images/image-20220105211637461.png)





### linux时间系统

时间中断是特别重要的中断。

系统利用时钟中断维持系统时间，促进进程切换，以保证所有进程共享cpu。

系统利用时钟中断进行记账，监督系统工作以及确定未来的调度优先级等工作。

可以说时钟是操作系统的脉搏。



![image-20220105212220145](images/image-20220105212220145.png)

![image-20220105214225550](images/image-20220105214225550.png)